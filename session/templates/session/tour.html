{% block javascript %}
{% spaceless %}
<script src="https://cdn.jsdelivr.net/npm/shepherd.js@5.0.1/dist/js/shepherd.js"></script>
<script type="text/javascript">
  function onboarding_toggler(section, mode) {
    $.post("{% url 'onboarding_toggler' %}", {
      section: section,
      mode: mode,
      csrfmiddlewaretoken: '{{ csrf_token }}'
    })
  }
</script>
{% if 'dashboard' in request.path and 'dashboard' in request.user.onboarding_sections %}
<script type="text/javascript">
  const tour = new Shepherd.Tour({
    useModalOverlay: true,
    defaultStepOptions: {
      cancelIcon: {
        enabled: true
      },
      classes: 'class-1 class-2',
      scrollTo: {
        behavior: 'smooth',
        block: 'center'
      }
    }
  });

  tour.addStep({
    title: 'Welcome to 3DOptimizer!',
    text: 'This is a quick introduction tour which should get you started on your first optimization session.',
    classes: 'example-step-extra-class',
    buttons: [{
      text: 'Next',
      action: tour.next
    }]
  });

  tour.addStep({
    text: 'Go ahead and create your first testing session by clicking "New Testing Session"!',
    canClickTarget: true,
    attachTo: {
      element: '#newSessionButton',
      on: 'bottom'
    },
    classes: 'example-step-extra-class',
    buttons: [{
      action() {
        return this.back();
      },
      classes: 'shepherd-button-secondary',
      text: 'Back'
    }]
  });

  window.addEventListener('load', function() {
    tour.start();
    $(".shepherd-cancel-icon").click(function() {
      onboarding_toggler('dashboard', false);
    })
  })
</script>
{% elif 'sessions/new' in request.path and 'new_session' in request.user.onboarding_sections %}

<script type="text/javascript">
  const tour = new Shepherd.Tour({
    useModalOverlay: true,
    defaultStepOptions: {
      cancelIcon: {
        enabled: true
      },
      classes: 'class-1 class-2',
      scrollTo: {
        behavior: 'smooth',
        block: 'center'
      }
    }
  });

  tour.addStep({
    text: 'Choose or create a material for the optimization session here.',
    canClickTarget: false,
    attachTo: {
      element: '.form-group',
      on: 'bottom'
    },
    classes: 'example-step-extra-class',
    buttons: [{
        action() {
          return this.back();
        },
        classes: 'shepherd-button-secondary',
        text: 'Back'
      },
      {
        text: 'Next',
        action: tour.next
      }
    ]
  });

  tour.addStep({
    text: 'Choose or create a 3D printer for the optimization session here.',
    canClickTarget: false,
    attachTo: {
      element: '#div_id_machine',
      on: 'bottom'
    },
    classes: 'example-step-extra-class',
    buttons: [{
        action() {
          return this.back();
        },
        classes: 'shepherd-button-secondary',
        text: 'Back'
      },
      {
        text: 'Next',
        action: tour.next
      }
    ]
  });

  tour.addStep({
    text: 'Choose an optimization strategy for the optimization session here.',
    canClickTarget: false,
    attachTo: {
      element: '#div_id_target',
      on: 'bottom'
    },
    classes: 'example-step-extra-class',
    buttons: [{
        action() {
          return this.back();
        },
        classes: 'shepherd-button-secondary',
        text: 'Back'
      },
      {
        text: 'Next',
        action: tour.next
      }
    ]
  });

  tour.addStep({
    text: 'Manage 3D Printers and Materials under the resources tab.',
    canClickTarget: true,
    attachTo: {
      element: '#resourcesDropdown',
      on: 'bottom'
    },
    classes: 'example-step-extra-class',
    buttons: [{
        action() {
          return this.back();
        },
        classes: 'shepherd-button-secondary',
        text: 'Back'
      },
      {
        text: 'Next',
        action() {
          onboarding_toggler('new_session', false);
          return this.next();
        }
      }
    ]
  });
  window.addEventListener('load', function() {
    onboarding_toggler('dashboard', false)
    tour.start();
    $(".shepherd-cancel-icon").click(function() {
      onboarding_toggler('new_session', false)
    })
  })
</script>
{% else %}
{% if object.test_number == "01" and object.executed is False and 'session_generate_1' in request.user.onboarding_sections %}

<script type="text/javascript">
  const tour = new Shepherd.Tour({
    useModalOverlay: true,
    defaultStepOptions: {
      cancelIcon: {
        enabled: true
      },
      classes: 'class-1 class-2',
      scrollTo: {
        behavior: 'smooth',
        block: 'center'
      }
    }
  });

  tour.addStep({
    title: 'Welcome to your first testing session!',
    text: 'The wizard will guide you through the tests to optimize selected processing parameters for the selected 3D printer/material combination.',
    classes: 'example-step-extra-class',
    buttons: [{
      text: 'Next',
      action: tour.next
    }]
  });

  tour.addStep({
    text: 'Here you can see the list with the available tests.',
    canClickTarget: false,
    attachTo: {
      element: '#test_selector',
      on: 'right'
    },
    classes: 'example-step-extra-class',
    buttons: [{
        action() {
          return this.back();
        },
        classes: 'shepherd-button-secondary',
        text: 'Back'
      },
      {
        text: 'Next',
        action: tour.next
      }
    ]
  });

  tour.addStep({
    text: 'The wizard will automatically guide you through the main tests.',
    canClickTarget: false,
    attachTo: {
      element: '#test_selector',
      on: 'right'
    },
    classes: 'example-step-extra-class',
    buttons: [{
        action() {
          return this.back();
        },
        classes: 'shepherd-button-secondary',
        text: 'Back'
      },
      {
        text: 'Next',
        action: tour.next
      }
    ]
  });

  tour.addStep({
    text: 'If you want to perform some of the optional tests or return to the previous tests, navigate through them by clicking on the test name.',
    canClickTarget: false,
    attachTo: {
      element: '#test_selector',
      on: 'right'
    },
    classes: 'example-step-extra-class',
    buttons: [{
        action() {
          return this.back();
        },
        classes: 'shepherd-button-secondary',
        text: 'Back'
      },
      {
        text: 'Next',
        action: tour.next
      }
    ]
  });

  tour.addStep({
    title: 'Processing parameter to be tested',
    text: 'Here you can see and change the range of the values to be tested.',
    attachTo: {
      element: '#div_id_min_max_parameter_one',
      on: 'bottom'
    },
    classes: 'example-step-extra-class',
    buttons: [{
        action() {
          return this.back();
        },
        classes: 'shepherd-button-secondary',
        text: 'Back'
      },
      {
        text: 'Next',
        action: tour.next
      }
    ]
  });

  tour.addStep({
    title: 'Processing parameter to be defined',
    text: 'The value of this processing parameter is required to generate the .GCODE file.',
    attachTo: {
      element: '#div_id_track_width_raft',
      on: 'top'
    },
    classes: 'example-step-extra-class',
    buttons: [{
        action() {
          return this.back();
        },
        classes: 'shepherd-button-secondary',
        text: 'Back'
      },
      {
        text: 'Next',
        action: tour.next
      }
    ]
  });

  tour.addStep({
    title: 'Predefined processing parameter',
    text: 'If a processing parameter has already been tested or it is locked for this test type its field will be inactive.',
    attachTo: {
      element: '#div_id_part_cooling_setpoint',
      on: 'top'
    },
    classes: 'example-step-extra-class',
    buttons: [{
        action() {
          return this.back();
        },
        classes: 'shepherd-button-secondary',
        text: 'Back'
      },
      {
        text: 'Next',
        action: tour.next
      }
    ]
  });

  tour.addStep({
    text: `Once you have filled the required fields, press "Generate .GCODE file" to continue!`,
    canClickTarget: false,
    attachTo: {
      element: '#gcode_button',
      on: 'top'
    },
    buttons: [{
        action() {
          return this.back();
        },
        classes: 'shepherd-button-secondary',
        text: 'Back'
      },
      {
        action() {
          return this.next();
        },
        text: 'Next'
      }
    ],
  });

  window.addEventListener('load', function() {
    onboarding_toggler(['dashboard', 'new_session'], false);
    tour.start();
    $(".shepherd-cancel-icon").click(function() {
      onboarding_toggler('session_generate_1', false);
    })
  })
</script>
{% elif object.test_number == "01" and object.executed is True and 'session_validate' in request.user.onboarding_sections %}

<script type="text/javascript">
  const tour = new Shepherd.Tour({
    useModalOverlay: true,
    defaultStepOptions: {
      cancelIcon: {
        enabled: true
      },
      classes: 'class-1 class-2',
      scrollTo: {
        behavior: 'smooth',
        block: 'center'
      }
    }
  });

  tour.addStep({
    text: 'Now you can download, print and validate the paremeters you selected in the previous step',
    classes: 'example-step-extra-class',
    buttons: [{
      text: 'Next',
      action: tour.next
    }]
  });

  tour.addStep({
    text: 'Download and run the .GCODE file on your 3D printer.',
    canClickTarget: false,
    attachTo: {
      element: '.btn-outline-secondary',
      on: 'right'
    },
    classes: 'example-step-extra-class',
    buttons: [{
        action() {
          return this.back();
        },
        classes: 'shepherd-button-secondary',
        text: 'Back'
      },
      {
        text: 'Next',
        action: tour.next
      }
    ]
  });

  tour.addStep({
    title: 'Validation table',
    text: 'This table represents the array of different setting combinations used in the test.<br>\
  Once you have printed the test G-Code, you may select the best test structure on this table.<br>',
    canClickTarget: false,
    attachTo: {
      element: '.table',
      on: 'left'
    },
    classes: 'example-step-extra-class',
    buttons: [{
        action() {
          return this.back();
        },
        classes: 'shepherd-button-secondary',
        text: 'Back'
      },
      {
        text: 'Next',
        action: tour.next
      }
    ]
  });

  window.addEventListener('load', function() {
    onboarding_toggler(['dashboard', 'new_session', 'session_generate_1'], false);
    tour.start();
    $(".shepherd-cancel-icon").click(function() {
      onboarding_toggler('session_validate', false);
    })
  })
</script>
{% elif object.test_number == "03" and 'session_generate_2' in request.user.onboarding_sections %}

<script type="text/javascript">
  const tour = new Shepherd.Tour({
    useModalOverlay: true,
    defaultStepOptions: {
      cancelIcon: {
        enabled: true
      },
      classes: 'class-1 class-2',
      scrollTo: {
        behavior: 'smooth',
        block: 'center'
      }
    }
  });

  tour.addStep({

    title: 'Test switch panel',
    text: 'You can now see that the previous test has been completed.',
    canClickTarget: false,
    attachTo: {
      element: '#test_selector',
      on: 'right'
    },
    classes: 'example-step-extra-class',
    buttons: [{
      text: 'Next',
      action: tour.next
    }]
  });

  tour.addStep({
    title: 'Overview pane',
    text: 'Here you can see a summary about the previous tests, generate a test report, and slicing configuration files.',
    attachTo: {
      element: '#overview',
      on: 'bottom'
    },
    classes: 'example-step-extra-class',
    buttons: [{
        action() {
          return this.back();
        },
        classes: 'shepherd-button-secondary',
        text: 'Back'
      },
      {
        text: 'Next',
        action: tour.next
      }
    ]
  });

  tour.addStep({
    text: 'This concludes the introduction. If you have any further questions, do not hesitate to consult our "Help" section, found at the top of the page!',

    classes: 'example-step-extra-class',
    buttons: [{
        action() {
          return this.back();
        },
        classes: 'shepherd-button-secondary',
        text: 'Back'
      },
      {
        text: 'Finish',
        action: function() {
          $.get("{% url 'disable_onboarding' %}", {
            next: '{{ request.path }}',
            csrfmiddlewaretoken: '{{ csrf_token }}'
          })
          return this.next()
          // window.location.replace("{% url 'disable_onboarding' %}?next={{ request.path }}");
        }
      }
    ]
  });


  window.addEventListener('load', function() {
    onboarding_toggler(['dashboard', 'new_session', 'session_generate_1', 'session_validate'], false);
    tour.start();
    $(".shepherd-cancel-icon").click(function() {
      onboarding_toggler('session_generate_2', false);
    })
  })
</script>
{% endif %}
{% endif %}
{% endspaceless %}
{% endblock %}
